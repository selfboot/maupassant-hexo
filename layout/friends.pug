extends base

block title
  title= page.title

block content
  .post
    h1.post-title= page.title
    .post-content
      if theme.friends && theme.friends.length > 0
        .friends-section
          .friends-grid
            each friend in theme.friends
              .friend-card
                a.friend-link(href=friend.link, target='_blank')
                  .friend-avatar
                    img(src=friend.avatar, alt="", onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiNmMGYwZjAiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik0xMiAyQzEwLjkgMiAxMCAyLjkgMTAgNFMxMC45IDYgMTIgNlMxNCA1LjEgMTQgNFMxMy4xIDIgMTIgMlpNMjEgOUgxNUw5LjUgM0w4LjUgNEwxMy40IDlIMyAoIDEzIDEyIDEzIDEwSDExVjE5SDEzVjIxSDEyVjE5SDIxWiIgZmlsbD0iIzk5OTk5OSIvPgo8L3N2Zz4KPC9zdmc+Cg=='")
                  .friend-info
                    .friend-name= friend.name
                    .friend-desc(title=friend.description)= friend.description
      
      != page.content
                    
  style.
    .friends-section {
      margin-top: 1.5rem;
    }
    
    .friends-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .friend-card {
      background: #fff;
      border-radius: 16px;
      padding: 0.9rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.06);
    }
    
    .friend-card:hover {
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      transform: translateY(-2px);
    }
    
    .friend-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: inherit;
      gap: 0.8rem;
    }
    
    .friend-avatar {
      flex-shrink: 0;
      width: 42px !important;
      height: 42px !important;
      border-radius: 50% !important;
      overflow: hidden !important;
      background: #f5f5f5; /* placeholder background to avoid flash */
      position: relative;
    }

    /* remove size from link, keep it as inline element */
    .friend-avatar a,
    .friend-avatar a.fancybox {
      display: block !important;
      width: 100% !important;
      height: 100% !important;
      border-radius: 50% !important;
      overflow: hidden !important;
      margin: 0 !important;
      padding: 0 !important;
      border: none !important;
      line-height: 0 !important;
      background: none !important;
    }

    .friend-avatar img {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      object-position: center center !important;
      display: block;
    }
    
    .friend-info {
      flex: 1;
      min-width: 0;
    }
    
    .friend-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: #1f2937;
      line-height: 1.3;
      margin-bottom: 0.4rem;
      transition: color 0.2s ease;
    }
    
    .friend-card:hover .friend-name {
      color: #3b82f6;
    }
    
    .friend-desc {
      font-size: 0.85rem;
      color: #6b7280;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: help;
    }
    
    /* Tooltip for friend-desc */
    .friend-desc[title]:hover::after {
      content: attr(title);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 110%;
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 0.4rem 0.6rem;
      border-radius: 4px;
      font-size: 0.75rem;
      line-height: 1.3;
      white-space: normal;
      z-index: 1000;
      pointer-events: none;
      max-width: 280px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .friend-desc[title]:hover::before {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100%;
      border: 5px solid transparent;
      border-top-color: rgba(0,0,0,0.8);
      margin-bottom: 2px;
    }
    
    /* ---- responsive sizes ---- */
    @media (max-width: 1024px) {
      .friend-card {
        padding: 1rem;
      }
      
      .friend-link {
        gap: 0.8rem;
      }
      
      .friend-avatar { width: 50px !important; height: 50px !important; }
      
      .friend-name {
        font-size: 1rem;
      }
      
      .friend-desc {
        font-size: 0.85rem;
      }
    }
    
    @media (max-width: 768px) {
      .friends-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 0.8rem;
      }
      
      .friend-card {
        padding: 1rem;
      }
      
      .friend-link {
        gap: 0.8rem;
      }
      
      .friend-avatar { width: 46px !important; height: 46px !important; }
      
      .friend-name {
        font-size: 0.95rem;
        margin-bottom: 0.3rem;
      }
      
      .friend-desc {
        font-size: 0.8rem;
      }
    }
    
    @media (max-width: 480px) {
      .friends-grid {
        grid-template-columns: 1fr;
        gap: 0.6rem;
      }
      
      .friend-card {
        padding: 0.9rem;
      }
      
      .friend-link {
        gap: 0.7rem;
      }
      
      .friend-avatar { width: 42px !important; height: 42px !important; }
      
      .friend-name {
        font-size: 0.9rem;
      }
      
      .friend-desc {
        font-size: 0.75rem;
      }
    }
  
  if page.donate
     include _widget/donate.pug
  if page.comments
    include _partial/comments.pug 